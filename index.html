<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

<script>
    // --- STEP 1: Replace this with your actual Firebase Config ---
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        databaseURL: "https://YOUR_PROJECT.firebaseio.com",
        projectId: "YOUR_PROJECT",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const messagesRef = database.ref('messages');

    const users = {
        "daman": "Hulk4551622",
        "lipsy": "mandeep"
    };

    let currentUser = "";

    function handleLogin() {
        const userInp = document.getElementById('username').value.toLowerCase();
        const passInp = document.getElementById('password').value;
        const errorMsg = document.getElementById('error-msg');

        if (users[userInp] && users[userInp] === passInp) {
            currentUser = userInp;
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('chat-screen').style.display = 'flex';
            document.getElementById('display-user').innerText = "Hi, " + currentUser.charAt(0).toUpperCase() + currentUser.slice(1) + "! ðŸŒ¸";
            
            // Start listening for messages after login
            listenForMessages();
        } else {
            errorMsg.style.display = 'block';
        }
    }

    // --- STEP 2: Send message to the Cloud Database ---
    function sendMessage() {
        const input = document.getElementById('msg-input');
        const text = input.value.trim();
        
        if (text !== "") {
            messagesRef.push({
                sender: currentUser,
                text: text,
                timestamp: Date.now()
            });
            input.value = "";
        }
    }

    // --- STEP 3: Listen for messages from the other user ---
    function listenForMessages() {
        messagesRef.on('child_added', (snapshot) => {
            const data = snapshot.val();
            displayMessage(data.sender, data.text);
        });
    }

    function displayMessage(sender, text) {
        const chatBox = document.getElementById('chat-box');
        const msgDiv = document.createElement('div');
        
        // Check if the message is from 'me' or the 'other'
        const isMe = sender === currentUser;
        msgDiv.classList.add('message', isMe ? 'sent' : 'received');
        
        msgDiv.innerHTML = `
            <div class="user-tag">${isMe ? 'Me' : sender}</div>
            <div>${text}</div>
        `;
        
        chatBox.appendChild(msgDiv);
        chatBox.scrollTop = chatBox.scrollHeight;
    }

    document.getElementById('msg-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') sendMessage();
    });
</script>
